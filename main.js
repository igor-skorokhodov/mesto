(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=n.name,this._link=n.link,this._template=r,this._element=this._template.cloneNode(!0),this._handleCardClick=o,this._id=n._id,this._idCardOwner=n.owner._id,this._idUser=e._id,this._countLikes=n.likes.length,this._removeCardFunction=i,this._likeCardFunction=a,this._card=this._element.querySelector(".element"),this._heart=this._element.querySelector(".element__heart"),this._likes=this._element.querySelector(".element__likes")}var n,r;return n=t,(r=[{key:"createCard",value:function(e){var t=this._element.querySelector(".element__title"),n=this._element.querySelector(".element__picture");return t.textContent=this._name,n.src=this._link,n.alt="Картинка карточки "+this._name,this.isLiked(e)?(this._heart.classList.remove("element__heart_anabled"),this._likes.textContent=e.likes.length):(this._heart.classList.add("element__heart_anabled"),this._likes.textContent=e.likes.length),this._addEventListeners(e),this._element}},{key:"likeCard",value:function(e){this._heart.classList.add("element__heart_anabled"),this._likes.textContent=e.likes.length+1}},{key:"dislikeCard",value:function(e){this._heart.classList.remove("element__heart_anabled"),this._likes.textContent=e.likes.length-1}},{key:"deleteCard",value:function(){this._card.remove()}},{key:"isLiked",value:function(e){var t=this,n=0;return e.likes.forEach((function(e){e._id!==t._idUser||e._id!==t._idUser?n+=0:n+=1})),0===n}},{key:"_addEventListeners",value:function(e){var t=this,n=this._element.querySelector(".element__heart"),r=this._element.querySelector(".element__trash");this._element.querySelector(".element__picture").addEventListener("click",(function(){t._handleCardClick(t._name,t._link)})),n.addEventListener("click",(function(){t._likeCardFunction()})),this._idCardOwner===this._idUser?r.addEventListener("click",(function(){t._removeCardFunction(e)})):r.remove()}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=t,this._container=document.querySelector(n)}var t,r;return t=e,(r=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._form=n}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e,t){var n=this._form.querySelector(".".concat(e.id));e.classList.add(this._inputErrorClass),n.textContent=t,n.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){var t=this._form.querySelector(".".concat(e.id));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}},{key:"_toggleButtonState",value:function(e,t){this._hasInvalidInput(e)?(t.classList.add(this._inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._inactiveButtonClass),t.disabled=!1)}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_isValid",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_setEventListeners",value:function(){var e=this,t=Array.from(this._form.querySelectorAll(this._inputSelector));this._form.addEventListener("reset",(function(){t.forEach((function(r){e._hideInputError(r),e._toggleButtonState(t,n)}))}));var n=this._form.querySelector(this._submitButtonSelector);this._toggleButtonState(t,n),t.forEach((function(r){r.addEventListener("input",(function(){e._isValid(r),e._toggleButtonState(t,n)}))}))}},{key:"enableValidation",value:function(){this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners(this._form)}}])&&o(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_active"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_active"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){t.target.classList.contains("popup_active")&&e.close(),t.target.classList.contains("popup__close-button")&&e.close()}))}}])&&a(t.prototype,n),e}();function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(r);if(o){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,e))._handleFormSubmit=t,r._popupSelector=e,r._form=r._popup.querySelector(".popup__form-input"),r._postUserInfo=n,r}return t=a,(n=[{key:"setEventListeners",value:function(){var e=this;this._form.addEventListener("submit",(function(){e._handleFormSubmit(e._getInputValues())})),l(_(a.prototype),"setEventListeners",this).call(this)}},{key:"_getInputValues",value:function(){var e=this;return this._inputList=document.querySelectorAll(".popup__form"),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"close",value:function(){this._form.reset(),l(_(a.prototype),"close",this).call(this)}}])&&c(t.prototype,n),a}(s);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(r);if(o){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._fullPicture=document.querySelector(".popup__picture"),t._textPicture=document.querySelector(".popup__sign"),t}return t=a,(n=[{key:"open",value:function(e,t){y(k(a.prototype),"open",this).call(this),this._fullPicture.src=t,this._fullPicture.alt="Место крупным планом",this._textPicture.textContent=e}}])&&v(t.prototype,n),a}(s);function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userNameSelector=document.querySelector(t),this._jobSelector=document.querySelector(n),this._id=10,this._name="",this._about="",this._avatar="",this._nameValue=document.querySelector(".popup__form_info_name"),this._jobValue=document.querySelector(".popup__form_info_job")}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._userNameSelector.textContent,job:this._jobSelector.textContent}}},{key:"setUserInfo",value:function(e){this._id=e._id,this._name=e.name,this._about=e.about,this._userNameSelector.textContent=this._name,this._jobSelector.textContent=this._about,this._nameValue.value=this._name,this._jobValue.value=this._jobValue}},{key:"setAvatar",value:function(e){this._avatar=e.avatar,document.querySelector(".profile__avatar").src=this._avatar}}])&&g(t.prototype,n),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t.url,this._headers=t.headers}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){var e=this;return fetch(this._url+"users/me",{method:"GET",headers:this._headers}).then((function(t){return e._getResponseData(t)}))}},{key:"postUserInfo",value:function(e,t){var n=this;return fetch(this._url+"users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return n._getResponseData(e)}))}},{key:"getAllCards",value:function(){var e=this;return fetch(this._url+"cards",{method:"GET",headers:this._headers}).then((function(t){return e._getResponseData(t)}))}},{key:"addNewCard",value:function(e,t){var n=this;return fetch(this._url+"cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._getResponseData(e)}))}},{key:"removeCard",value:function(e){var t=this;return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"setLike",value:function(e){var t=this;return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"deleteLike",value:function(e){var t=this;return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"userAvatarUpdate",value:function(e){var t=this;return fetch(this._url+"users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return t._getResponseData(e)}))}},{key:"_getResponseData",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}}])&&C(t.prototype,n),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_active"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_active"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){t.target.classList.contains("popup_active")&&e.close(),t.target.classList.contains("popup__close-button")&&e.close()}))}}])&&L(t.prototype,n),e}(),O=document.querySelector(".profile__edit-button"),j=document.querySelector(".profile__add-button"),P=(document.querySelector(".popup__submit-button"),document.querySelector("#card").content),x=(document.querySelector(".popup__add-button"),{formSelector:".popup__form-input",inputSelector:".popup__form",submitButtonSelector:".popup__submit",inactiveButtonClass:"form__inactive",inputErrorClass:"popup__form-error",errorClass:"popup__form_error-active"}),T=document.querySelectorAll(x.formSelector),R=document.querySelector(".profile__avatar-container"),I=document.querySelector(".popup__form_info_name"),D=document.querySelector(".popup__form_info_job"),B=document.querySelector(".profile__avatar"),U=document.querySelector(".profile__name"),V=document.querySelector(".profile__profession");T.forEach((function(e){new i(x,e).enableValidation()}));var A=new w({url:"https://mesto.nomoreparties.co/v1/cohort-20/",headers:{authorization:"9c0a4b23-790f-477e-8923-142dbfd6589d","Content-Type":"application/json"}}),N=new q("#delete");N.setEventListeners();var F=new E(".profile__name",".profile__profession");Promise.all([A.getUserInfo(),A.getAllCards()]).then((function(e){F.setUserInfo(e[0]),F.setAvatar(e[0]),e[1].reverse(),e[1].forEach((function(e){var t=X(F,e);H.addItem(t)})),H.renderItems(e[1])})).catch((function(e){console.log(e)})),O.addEventListener("click",(function(){G.open(),I.value=U.textContent,D.value=V.textContent}));var J=document.querySelector(".popup__submit-button"),G=new p("#edit",(function(e){J.innerText="Сохранение...",A.postUserInfo(e.name,e.job).then((function(e){F.setUserInfo(e),G.close()})).catch((function(e){console.log(e)})).finally((function(){J.innerText="Сохранить"}))}),(function(){}));G.setEventListeners();var H=new r((function(){}),".elements"),z=document.querySelector("#saveAddButton"),M=new p("#add",(function(e){z.innerText="Сохранение...";var t=[];t.push(e),A.addNewCard(e.name_pic,e.link).then((function(e){var t=X(F,e);H.addItem(t),M.close(),z.innerText="Сохраннить",z.disabled=!0})).catch((function(e){console.log(e)})).finally((function(){z.innerText="Сохранить"})),H.renderItems(t)}),(function(){}),(function(){}));M.setEventListeners();var K=document.querySelector("#avatarSaveButton"),Q=new p("#changeavatar",(function(e){K.innerText="Сохранение...",A.userAvatarUpdate(e.avatar).then((function(){Q.close(),B.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){K.innerText="Сохранить"}))}),(function(){}));Q.setEventListeners();var W=new S("#picture");function X(e,n){var r=new t(e,n,P,(function(){!function(e){var t=document.querySelector(".popup__picture");t.src=e.link,t.textContent=e.name,W.open(e.name,e.link)}(n)}),(function(){!function(e,t){N.open(),Y.addEventListener("click",(function(){!function(e,t){A.removeCard(t._id).then((function(){N.close(),e.deleteCard()})).catch((function(e){console.log(e)})).finally((function(){Y.innerText="Да"}))}(e,t),Y.innerText="Удаление..."}),{once:!0})}(r,n)}),(function(){!function(e,t){e.isLiked(t)?A.setLike(t._id).then((function(){e.likeCard(t)})).catch((function(e){console.log(e)})):A.deleteLike(t._id).then((function(){e.dislikeCard(t)})).catch((function(e){console.log(e)}))}(r,n)}));return r.createCard(n)}W.setEventListeners(),j.addEventListener("click",(function(){M.open()})),R.addEventListener("click",(function(){Q.open()}));var Y=document.querySelector("#questionButton")})();